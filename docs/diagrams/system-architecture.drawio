<mxfile host="app.diagrams.net" modified="2026-02-26T00:00:00.000Z" type="device">
  <diagram id="sys-arch" name="システム構成図">
    <mxGraphModel dx="1422" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- ===== Title ===== -->
        <mxCell id="title" value="niwalog システム構成図" style="text;html=1;fontSize=20;fontStyle=1;align=center;verticalAlign=middle;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="350" y="5" width="400" height="30" as="geometry" />
        </mxCell>

        <!-- ===== Browser / PWA Container ===== -->
        <mxCell id="browser" value="&lt;b&gt;ブラウザ / PWA&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;container=1;collapsible=0;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;verticalAlign=top;spacingTop=5;opacity=50;" vertex="1" parent="1">
          <mxGeometry x="80" y="45" width="940" height="190" as="geometry" />
        </mxCell>
        <mxCell id="react" value="&lt;b&gt;React 19 + Vite 7&lt;/b&gt;&lt;br&gt;TypeScript / Tailwind CSS&lt;br&gt;React Router (SPA)&lt;br&gt;Recharts (グラフ)&lt;br&gt;コード分割 (lazy import)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="browser">
          <mxGeometry x="20" y="40" width="280" height="130" as="geometry" />
        </mxCell>
        <mxCell id="zustand" value="&lt;b&gt;Zustand Store&lt;/b&gt;&lt;br&gt;persist middleware&lt;br&gt;→ localStorage&lt;br&gt;&lt;br&gt;認証情報・設定・UIステート" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="browser">
          <mxGeometry x="330" y="40" width="280" height="130" as="geometry" />
        </mxCell>
        <mxCell id="sw" value="&lt;b&gt;Service Worker&lt;/b&gt;&lt;br&gt;Workbox (vite-plugin-pwa)&lt;br&gt;&lt;br&gt;Precache (全ビルドアセット)&lt;br&gt;+ Runtime Cache 戦略&lt;br&gt;+ 更新通知 UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;" vertex="1" parent="browser">
          <mxGeometry x="640" y="40" width="280" height="130" as="geometry" />
        </mxCell>

        <!-- ===== Hosting / Cache Row ===== -->
        <mxCell id="ghpages" value="&lt;b&gt;GitHub Pages&lt;/b&gt;&lt;br&gt;静的ファイル配信" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="290" width="280" height="55" as="geometry" />
        </mxCell>
        <mxCell id="cache" value="&lt;b&gt;Cache Storage&lt;/b&gt;&lt;br&gt;Workbox 管理 (ブラウザ内)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="740" y="290" width="280" height="55" as="geometry" />
        </mxCell>

        <!-- ===== Google Cloud Container ===== -->
        <mxCell id="google" value="&lt;b&gt;Google Cloud&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;container=1;collapsible=0;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;verticalAlign=top;spacingTop=5;opacity=50;" vertex="1" parent="1">
          <mxGeometry x="80" y="400" width="940" height="150" as="geometry" />
        </mxCell>
        <mxCell id="oauth" value="&lt;b&gt;Google OAuth 2.0&lt;/b&gt;&lt;br&gt;(GIS - Google Identity Services)&lt;br&gt;&lt;br&gt;認証・トークン管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="google">
          <mxGeometry x="20" y="40" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="sheets" value="&lt;b&gt;Google Sheets API v4&lt;/b&gt;&lt;br&gt;&lt;br&gt;データベースとして利用&lt;br&gt;(プランター・活動記録・天気・土壌)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="google">
          <mxGeometry x="330" y="40" width="280" height="90" as="geometry" />
        </mxCell>
        <mxCell id="drive" value="&lt;b&gt;Google Drive API v3&lt;/b&gt;&lt;br&gt;&lt;br&gt;写真のアップロード・閲覧&lt;br&gt;サムネイル取得" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;" vertex="1" parent="google">
          <mxGeometry x="640" y="40" width="280" height="90" as="geometry" />
        </mxCell>

        <!-- ===== GAS Container ===== -->
        <mxCell id="gas" value="&lt;b&gt;Google Apps Script&lt;/b&gt;  (時間トリガーで自動実行)" style="rounded=1;whiteSpace=wrap;html=1;container=1;collapsible=0;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=13;verticalAlign=top;spacingTop=5;opacity=50;" vertex="1" parent="1">
          <mxGeometry x="80" y="610" width="600" height="130" as="geometry" />
        </mxCell>
        <mxCell id="weather-fetcher" value="&lt;b&gt;Weather Fetcher&lt;/b&gt;&lt;br&gt;6時間ごとに天気データを取得&lt;br&gt;→ Sheets に書き込み" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="gas">
          <mxGeometry x="20" y="40" width="260" height="70" as="geometry" />
        </mxCell>
        <mxCell id="soil-receiver" value="&lt;b&gt;Soil Sensor Receiver&lt;/b&gt;&lt;br&gt;M5Stack からの土壌データ受信&lt;br&gt;→ Sheets に書き込み" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" vertex="1" parent="gas">
          <mxGeometry x="310" y="40" width="260" height="70" as="geometry" />
        </mxCell>

        <!-- ===== Open-Meteo API ===== -->
        <mxCell id="openmeteo" value="&lt;b&gt;Open-Meteo API&lt;/b&gt;&lt;br&gt;(無料天気予報API)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="760" y="640" width="260" height="60" as="geometry" />
        </mxCell>

        <!-- ===== Edges ===== -->
        <!-- GitHub Pages → Browser (serves static files) -->
        <mxCell id="e1" value="配信" style="endArrow=classic;html=1;strokeColor=#666666;fontSize=10;fontColor=#666666;" edge="1" source="ghpages" target="browser" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- SW → Cache Storage -->
        <mxCell id="e2" value="キャッシュ管理" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#82b366;fontSize=10;fontColor=#82b366;dashed=1;" edge="1" source="sw" target="cache" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- React → OAuth (auth) -->
        <mxCell id="e3" value="認証" style="endArrow=classic;html=1;strokeColor=#6c8ebf;fontSize=10;fontColor=#6c8ebf;" edge="1" source="react" target="oauth" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- React → Sheets (data CRUD) -->
        <mxCell id="e4" value="データ読み書き" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#6c8ebf;fontSize=10;fontColor=#6c8ebf;" edge="1" source="zustand" target="sheets" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- React → Drive (photos) -->
        <mxCell id="e5" value="写真アップロード/閲覧" style="endArrow=classic;startArrow=classic;html=1;strokeColor=#6c8ebf;fontSize=10;fontColor=#6c8ebf;" edge="1" source="sw" target="drive" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Weather Fetcher → Open-Meteo -->
        <mxCell id="e6" value="天気取得" style="endArrow=classic;html=1;strokeColor=#9673a6;fontSize=10;fontColor=#9673a6;" edge="1" source="weather-fetcher" target="openmeteo" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Weather Fetcher → Sheets -->
        <mxCell id="e7" value="天気データ書き込み" style="endArrow=classic;html=1;strokeColor=#d6b656;fontSize=10;fontColor=#d6b656;entryX=0.3;entryY=1;entryDx=0;entryDy=0;" edge="1" source="weather-fetcher" target="sheets" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Soil Receiver → Sheets -->
        <mxCell id="e8" value="土壌データ書き込み" style="endArrow=classic;html=1;strokeColor=#d6b656;fontSize=10;fontColor=#d6b656;entryX=0.7;entryY=1;entryDx=0;entryDy=0;" edge="1" source="soil-receiver" target="sheets" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
